#!/usr/bin/env bash

# Syntax sugar
cmake_indent () {
    echo "              [cmake] $*"
}

# Initialize
cmake_indent "initlialize"
BUILD_DIR=$1   # /tmp/build_#HASH#
LIB_DIR=$2     # $BIN_DIR/lib
INSTALL_DIR=$3 # /app/.vendor
CACHE_DIR=$4   # /app/tmp/cache
PROFILE_DIR=$5 # $BUILD_DIR/.profile.d

# Build openCV
cmake_indent "build cmake"
cd $INSTALL_DIR
wget https://cmake.org/files/v3.8/cmake-3.8.2.tar.gz
tar -zxf cmake-3.8.2.tar.gz -C $INSTALL_DIR/
cd $INSTALL_DIR/cmake-3.8.2
./bootstrap && make && sudo make install

# Set .profile.d script
# Please do not use locally $variables in buildpack when you set environment variables,
# because .profile.d script runs after slug built, and this can not detect $variables.
# opencv_indent "set env path"
# echo 'export PATH="$PATH:/app/.vendor/opencv-3.1.0/bin"' >> $PROFILE_DIR/opencv.sh
# echo 'export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:/app/.vendor/opencv-3.1.0/lib"' >> $PROFILE_DIR/opencv.sh
