#!/bin/sh

# ユーティリティ タイトル表示
title() {
    echo "-----> $*"
}

# ユーティリティ サブタイトル表示
subtitle() {
    echo "       $*"
}

BUILD_DIR=$1
APP_DIR="app"

CACHE_DIR=$2
VENDOR_DIR="vendor/lib"

title "initlialize"
cd $BUILD_DIR
mkdir -p $VENDOR_DIR
cp -pr ../../lib/mecab-0.996.tar.gz $CACHE_DIR/$VENDOR_DIR/
cp -pr ../../lib/mecab-ipadic-2.7.0-20070801.tar.gz $CACHE_DIR/$VENDOR_DIR/

title "build mecab"
tar zxfv $CACHE_DIR/$VENDOR_DIR/mecab-0.996.tar.gz
cd $CACHE_DIR/$VENDOR_DIR/mecab-0.996
./configure --prefix=$BUILD_DIR/$APP_DIR/mecab-0.996 --sysconfdir=$BUILD_DIR/$APP_DIR/mecab-0.996/etc
make
make install
cd $HOME

title "build ipadic"

tar zxfv $CACHE_DIR/$VENDOR_DIR/mecab-ipadic-2.7.0-20070801.tar.gz
cd $CACHE_DIR/$VENDOR_DIR/mecab-ipadic-2.7.0-20070801
./configure --prefix=$BUILD_DIR/$APP_DIR/mecab-ipadic-2.7.0-20070801 --with-charset=utf8 --with-dicdir=$BUILD_DIR/$APP_DIR/mecab-ipadic-2.7.0-20070801/lib/mecab/dic/ipadic
make
make install
cd $HOME

title "tune mecab dictionary path"
cd $BUILD_DIR/$APP_DIR/mecab-0.996/etc/
sed -e "s/^dicdir.*/dicdir = $BUILD_DIR\/$APP_DIR\/mecab-ipadic-2.7.0-20070801\/lib\/mecab\/dic\/ipadic/" mecabrc
cd $HOME

title "set env path"
PROFILE_PATH = $BUILD_DIR/.profile.d/mecab.sh
mkdir -p $(dirname $PROFILE_PATH)
echo 'export PATH="$PATH:$BUILD_DIR/$APP_DIR/mecab-0.996/bin"'>> $PROFILE_PATH
echo 'export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$BUILD_DIR/$APP_DIR/mecab-0.996/lib"'>> $PROFILE_PATH
